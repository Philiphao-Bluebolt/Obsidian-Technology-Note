Tutorials are practices that would be thoroughly discussed in the lecture.

+ [[#Tutorial 1 - Simple Noise Calculation]]
	+ [[#1-1 Thermal noise RMS voltage calculation]]
	+ [[#1-2 Sum of noises calculation]]
	+ [[#1-3 Equivalent noise bandwidth calculation]]
	+ [[#1-4 Excess and thermal noise calculation]]
+ [[#Tutorial 2 - Diode and BJT noise model]]
	+ [[#2-1 Diode circuit noise analysis]]
	+ [[#2-2 BJT circuit noise analysis]]
+ [[#Tutorial 3 - Equivalent Input Noise and SNR]]
	+ [[#3-1 Equivalent input noise for BJT and FET amplifiers]]
	+ [[#3-2 Noise RMS with a inductive input source]]
+ [[#Tutorial 4 - Op Amp Noise Analysis]]
	+ [[#4-1 Op Amp equivalent input RMS voltage and input SNR]]
	+ [[#4-2 Usage of Op Amp equivalent input noise]]
+ [[#Tutorial 5 - Wideband Amplifier]]
	+ 

---
## Tutorial 1 - Simple Noise Calculation

![[EE4341 T1.pdf]]

![[T1 Guide(1).pdf]]

### 1-1  Thermal noise RMS voltage calculation

Determine the thermal noise voltage of a $50k\Omega$ resistor at room temperature of $290K$ for each of the following bandwidths: $50 kHz$, $1 MHz$, and $20 MHz$. There is no DC bias applied to the resistor. (Boltzmann's constant $k = 1.38 × 10^{‐23} J/K$)

![[Pasted image 20240904164152.png]]
The PSD of thermal noise is
$$\overline{v^2}=4kRT=8\times10^{-16}$$
Since a resistor's gain is the same for all frequencies, the given bandwidth is the equivalent noise bandwidth. So RMS voltage is 
$$V_{rms}=\sqrt{\overline{v^2}\Delta f}$$
The answer is $8.31\times 10^{-10}V$, $2.83\times 10^{-5}V$, $1.26\times 10^{-4}V$ for the three given frequencies.


### 1-2  Sum of noises calculation

For an equivalent noise bandwidth of $10 MHz$, determine the resultant RMS thermal noise voltage between points “x” and “y” shown in the graph. No DC voltage is applied to the circuit. The noises generated by the two resistors are uncorrelated. (Boltzmann's constant $k = 1.38 × 10‐23 J/K$ and $T = 300K$)

![[Pasted image 20240907210822.png]]
The uncorrelated noises of two serial resistor can be directly summed using the sum of square rule. As $x,y$ are open circuit, the noise voltage between them equals the sum of the two noise produced by resistors.
$$\overline{v^2_{xy}}=\overline{v^2_1}+\overline{v^2_2}=4kR_1T+4kR_2T$$
Then the RMS noise voltage
$$V_{rms}=\sqrt{\overline{v^2_{xy}}\Delta f}=\sqrt{4kT\Delta f(R_1+R_2)}=3.15\times 10^{-5} V=31.5\mu V$$

### 1-3  Equivalent noise bandwidth calculation

Derive the expression of the ‐3dB bandwidth and equivalent noise bandwidth of the circuit.

![[Pasted image 20240907214711.png]]
The transfer function of the network function is
$$H(j\omega)=\frac{\frac{R_2}{1+j\omega CR_2}}{R_1+\frac{R_2}{1+j\omega CR_2}}=\frac{R_2}{R_1+R_2+j\omega CR_1R_2}$$
Derive the power gain (square of intensity) of the function and use frequency $f$ instead ($\omega=2\pi f$)
$$|H(jf)|^2=\frac{|R_2|^2}{|R_1+R_2+2\pi fj CR_1R_2|^2}=\frac{(\frac{R_2}{R_1+R_2})^2}{1+(\frac{2\pi fCR_1R_2}{R_1+R_2})^2}=\frac{A_0^2}{1+(\frac{f}{f_c})^2}$$
The -3dB cutoff bandwidth is the frequency where the power gain drops to the half of mid-frequency power gain.
$$\begin{align}|H(jf_c)^2|&=\frac{|H(jf_0)^2|}{2}\\f_c&=\frac{R_1+R_2}{2\pi CR_1R_2}\end{align}$$
The equivalent noise bandwidth defines a square window on the frequency power gain bode plot which the total energy inside the square window equal to the total energy of the original power gain function.
$$\Delta f =\frac{\int_0^\infty|H(jf)|^2df}{A^2_0}=\frac{\pi}{2}f_c=\frac{R_1+R_2}{4 CR_1R_2}$$

### 1-4  Excess and thermal noise calculation

A $100 kΩ$ resistor has a noise index (NI) of $5 μV/V$. Derive a general expression for excess noise voltage over an arbitrary frequency range from $f1$ to $f2$ in terms of NI. If the DC voltage across the resistor is $5 V$, what is the total RMS noise voltage generated by this resistor between $20 Hz$ and $200 kHz$? (Boltzmann's constant $k = 1.38 × 10‐23 J/K$ and $T = 300K$)


As the NI is given, the noise analysis of resistor must include both excess noise and thermal noise. The noise power is the sum of two noises.
![[Pasted image 20240907230624.png]]
The PSD of excess noise is defined as
$$\overline{v_{e}^2}=\frac{m^2V^2}{f}=\frac{(NI)^2V^2}{f\ln10}$$
The RMS voltage of excess noise between the frequency can be calculated using integral
$$V_{f1-f2}=\sqrt{\int_{f_1}^{f_2}\frac{m^2V^2}{f}df}=\frac{NI}{\ln10}V\ln\frac{f_2}{f_1}$$
The calculation of total RMS also use an integral, it should take the thermal noise into account as well. 
$$V_{rms}=\sqrt{\int_{f_1}^{f_2}\overline{v_e^2}+\overline{v_t^2}}=\sqrt{\int_{f_1}^{f_2}\frac{(NI)^2V^2}{f\ln10}df+\int_{f_1}^{f_2}4kRTdf}=\sqrt{\frac{(NI)^2V^2}{\ln10}\ln\frac{f_2}{f_1}+4kRT(f_2-f_1)}=28.8\mu V$$


---
## Tutorial 2 - Diode and BJT noise model

![[EE4341 T2 1.pdf]]

![[T2 Guide(1).pdf]]

### 2-1  Diode circuit noise analysis

Assume that $V_D = 0.60V$. Boltzmann's constant $k = 1.38 \times 10^{-23}J/K$, $q = 1.6\times10^{-19} C$ and $T = 300K$.

+ (a) Calculate the mean-squared noise-voltage spectral density in $V^2/Hz$ at $v_o$ for the circuit and then calculate the RMS noise voltage in a $100 kHz$ equivalent noise bandwidth. Neglect capacitive effects, flicker noise and series resistance in the diode.

+ (b) If a $1000 pF$ capacitor is now connected across the diode, including flicker noise, calculate and plot the output mean-­squared noise voltage spectral density at $v_o$ in $V^2/Hz$ on log scales from $f = 1Hz$ to $f =10 MHz$. Flicker noise spectral density $= 3 \times 10^{-16}(I_D/f) A^2/Hz$.

![[Pasted image 20240908102455.png]]

First, we draw the equivalent noise circuit without the diode serial resistance and its noise.

![[Pasted image 20240908112330.png]]

The total noise PSD can be computed by the following equation, however we don't know the equivalent resistance $r_d$ and DC current $I_D$ of the diode.
$$\begin{align}\overline{v^2_o}&=(r_d\parallel R)^2(\overline{i^2_R}+\overline{i^2})\\&=(\frac{r_d R}{r_d + R})^2(\frac{4kT}{R}+2qI_D)\end{align}$$
Now calculate $I_D$ and $r_d$. As we know that the voltage drop of silicon diode $V_D=0.6V$, the DC current flowing through the circuit is
$$I_D=\frac{10V-0.6V}{20k\Omega}=0.47mA$$
The equivalent resistance $r_d$ is not fixed but is stable when the DC current is fixed
$$r_d=\frac{kT}{qI_D}=55.05\Omega$$
Now we can calculate $\overline{v^2_o}$
$$\overline{v^2_o}=4.558\times10^{-19}\quad V^2/Hz$$
The RMS noise voltage is
$$V_{rms}=\sqrt{\overline{v^2_o}\Delta f}=0.21\mu V$$

Now we consider the effect of the flicker noise and the extra capacitor.

![[Pasted image 20240908120432.png]]
The new capacitor doesn't affect the DC current of the circuit, but it change the equation of the output noise PSD
$$\begin{align}\overline{v^2_o}&=(r_d\parallel R\parallel C)^2(\overline{i^2_R}+\overline{i^2})\\&=|\frac{1}{\frac{1}{R}+\frac{1}{r_d}+j2\pi fC}|^2(\frac{4kT}{R}+2qI_D+k_1\frac{I_D^a}{f})\\&=\frac{R^2r_d^2}{r_d^2+2r_dR+R^2+4\pi ^2C^2R^2 r_d^2f^2} (1.51\times10^{-22}+\frac{1.41\times10^{-19}}{f})\\&=\frac{1.21\times10^{12}}{4.02\times10^8+4.79\times10^{-5}f^2}(1.51\times10^{-22}+\frac{1.41\times10^{-19}}{f})\end{align}$$

The frequency response of $\overline{v_o^2}$ has two cutoff frequency $f_1, f_2$, the following equations show how they're calculated.
$$\begin{align}1.51\times10^{-22}&=\frac{1.41\times10^{-19}}{f_2}\\f_1&=933.77Hz\end{align}$$
$$\begin{align}4.79\times10^{-5}f_1^2&=4.02\times10^8\\f_2&=2.897MHz\end{align}$$

Now draw the approximate bode plot, the lowest frequency in the graph could be $1Hz$
$$\overline{v^2_o}|_{f=1Hz}=4.2\times10^{-16} V^2/Hz$$
![[Pasted image 20240916145120.png]]


### 2-2  BJT circuit noise analysis

The amplifier circuit has a $-3dB$ bandwidth of $10 kHz$ (single-pole response).
Boltzmann's constant $k = 1.38 \times 10^{-2}J/K$, $q = 1.6\times10^{-19} C$ and $T = 300K$. 
BJT parameters $\beta=150$, $r_{bb'}=60\Omega$.
Ignore flicker noise and the thermal noise of the load resistance.

+ (a) Determine the value of $V_S$ so that $SNR = 0 dB$.
+ (b) Show that if a BJT is driven from a signal source with a source resistance Rs, the value of biasing collector current for maximum sensitivity is given by the following expression.
+ (c) Determine the value of biasing $I_c$ for max $SNR$ and obtain $V_S$ for $SNR = 0 dB$ under the new biasing condition.
![[Pasted image 20240921152749.png]]

### (a) 





---
## Tutorial 3 - Equivalent Input Noise and SNR

![[EE4341 T3.pdf]]

![[T3 Guide(1).pdf]]

### 3-1  Equivalent input noise for BJT and FET amplifiers



### 3-2  Noise RMS with a inductive input source


---
## Tutorial 4 - Op Amp Noise Analysis

![[EE4341 T4.pdf]]

![[T4 Guide(1).pdf]]

### 4-1  Op Amp equivalent input RMS voltage and input SNR

A signal source with $V_s = 5 mV$ will be connected to the amplifier circuit designed with Op Amp. Assume that the amplifier circuit is a ideal low pass filter for noise within $\Delta f =20 kHz$. Boltzmann’s constant $k = 1.38 \times 10^{‐23} J/K$ and $T = 300 K$ and $R_3=600\Omega$

+ (a) Obtain total equivalent RMS noise voltage at the non‐inverting input of the Op Amp
+ (b) Determine the SNR

Solve the questions for

1. Op Amp $\mu A741$ 
2. Op Amp $SE5534$
3. Non-inverting Amplifier
4. Inverting Amplifier (Gain $A=10$)


![[Pasted image 20240916155043.png]]
### (a) $\mu A741$

#### Non-inverting Amplifier

For the non-inverting amplifier, its noise model equivalent noise model is shown below

![[Pasted image 20240916162534.png]]

$$\begin{align}(\frac{R_1+R_2}{R_1})^2\overline{e^2_{ni}}&=(\frac{R_1+R_2}{R_1})^2(\overline{e_3^2}+R_3^2\overline{i_n^2}+\overline{e_n^2})+(\frac{R_2}{R_1})^2\overline{e^2_1}+\overline{e^2_2}+R_2^2\overline{i^2_n}\\\overline{e^2_{ni}}&=(\overline{e_3^2}+R_3^2\overline{i_n^2}+\overline{e_n^2})+\frac{R_2^2\overline{e^2_1}+R_1^2\overline{e^2_2}+R_1^2R_2^2\overline{i^2_n}}{(R_1+R_2)^2}\\\end{align}$$

> [!FAQ] How does cancellation of bias work?
> The bias here refers to the common mode input signal.

To cancel out the DC bias current, we make 
$$R_1 // R_2 =R_n= R_3$$
Which means
$$\begin{align}\overline{e^2_{ni}}&=\overline{e_n^2}+\overline{i_n^2}(R_3^2+R_n^2)+4kT(R_3+R_n)\\&=\overline{e_n^2}+2R_3^2\overline{i_n^2}+8R_3kT\\&=8.1\times10^{-16}\quad V^2/Hz\end{align}$$
The total RMS input noise voltage is
$$V_{rms}=\sqrt{\overline{e^2_{ni}}\Delta f}=4.0\times10^{-6}V=4 \mu V$$

The input SNR of the amplifier 
$$SNR_i(dB)=10\log\frac{V_i^2}{V_{rms}^2}=20log\frac{V_i}{V_{rms}}=1.56\times10^{22}=61.93dB$$

#### Inverting Amplifier

Since the equivalent input noise $\overline{e^2_{ni}}$ is located at the non-inverting input node, we need to equate it to the inverting input node.

![[Pasted image 20240920145201.png]]
$$\overline{e^2_{ni}}\frac{R_1+R_2}{R_1}=\overline{e^2_{nni}}\frac{R_2}{R_1}$$
$$\overline{e^2_{nni}}=\frac{R_1+R_2}{R_2}\overline{e^2_{ni}}$$
The required inverting gain is 10, so $R_2=10R_1$
$$\overline{e^2_{nni}}=1.1\overline{e^2_{ni}}=8.9\times10^{-16}\quad V^2/Hz$$
$$V_{nrms}=\sqrt{\overline{e^2_{nni}}\Delta f}=4.22\times10^{-6}=4.22 \mu V$$
The inverting input SNR of the amplifier 
$$SNR_{ni}(dB)=20log\frac{V_i}{V_{nrms}}=61.47dB$$

### (b) $SE5534$

Luckily, the replacement of Op Amp doesn't change the input signal model or noise model at all. Only the Op Amp internal noise sources $\overline{i^2_n}, \overline{v^2_n}$ are changed, affecting the PSD and RMS of equivalent input noise.

#### Non-inverting Amplifier

$$\overline{e^2_{ni}}=\overline{e_n^2}+2R_3^2\overline{i_n^2}+8R_3kT=3.59\times10^{-17}\quad V^2/Hz$$
$$SNR_i(dB)=20log\frac{V_i}{\sqrt{\overline{e^2_{ni}}\Delta f}}=75.42dB$$
#### Inverting Amplifier

$$\overline{e^2_{nni}}=1.1\overline{e^2_{ni}}=3.95\times10^{-17}\quad V^2/Hz$$
$$SNR_{ni}(dB)=20log\frac{V_i}{\sqrt{\overline{e^2_{nni}}\Delta f}}=75.00dB$$


### 4-2  Usage of Op Amp equivalent input noise

The circuit is designed to give an output $v_o = 2(v_1 - v_2 - v_3)$, where $v_1$, $v_2$ and $v_3$ are the input voltages.

The Op Amp has a GBW product of $10^6$ 
(Note: GBW = ‐3dB bandwidth of the amplifier multiplies mid‐band voltage gain of the amplifier). 

The equivalent input voltage and current noise spectral densities for the op amp are:
$$\overline{v^2_n}=e^2_{nw}(\frac{f_{ce}}{f}+1) \quad e_{nw}=20nV/\sqrt{Hz} \quad f_{ce}=200Hz$$
$$\overline{i^2_n}=i^2_{nw}(\frac{f_{ci}}{f}+1) \quad i_{nw}=0.5pA/\sqrt{Hz} \quad f_{ce}=2000Hz$$
(Boltzmann’s constant $k = 1.38 \times 10^{‐23} J/K$ and $T = 300 K$ and $R_1 = R_3 = 10 k\Omega$)

+ (a) Determine the values of resistors $R_2$, $R_4$ and $R_F$
+ (b) Obtain the RMS and peak‐to‐peak output noise voltage above $1Hz$

![[Pasted image 20240917012223.png]]
#### (a)

Assume that the Op Amp input voltage is $v_i$ , the following equations describes the voltages relationship.
$$v_i=\frac{R_3}{R_3+R_4}v_1$$
$$\frac{v_3-v_i}{R_1}+\frac{v_2-v_i}{R_2}=\frac{v_i-v_o}{R_F}$$
So we have 
$$\begin{align}v_o&=(1+\frac{R_F}{R_1}+\frac{R_F}{R_2})\frac{R_3}{R_3+R_4}v_1-\frac{R_F}{R_2}v_2-\frac{R_F}{R_1}v_3\\&=2v_1-2v_2-2v_3\end{align}$$
Then
$$\begin{cases}R_F=20k\Omega\\R_2=10k\Omega\\R_4=15k\Omega\end{cases}$$

#### (b)

Previously, we already derived the equation of equivalent input noise voltage for a typical Op Amp negative feedback circuit. 
$$\overline{e^2_{ni}}=\overline{e_n^2}+\overline{i_n^2}(R_p^2+R_n^2)+4kT(R_p+R_n)$$
In the circuit here, we have
$$R_p=R_3//R_4=6k\Omega$$
$$R_n=R_1//R_2//R_F=4k\Omega$$

---
## Tutorial 5 - Wideband Amplifier

![[EE4341 T5.pdf]]


